<!DOCTYPE html>
<html>
<head>
    <script src="/scripts/lib/shotenjin.js" ></script>
</head>
<body>

<!-- template -->

<script id="tpl_list" type="text/x-shotenjin-template">
    <?js for (var i = 0; i < sets.length; i++) { ?>
    <div class="set">
        <div class="set_title">
            #{sets[i].name}
            <span class="actions">
                <a href="#">All</a>
                <a href="#" id="set-put-#{sets[i].id}" data-setId="#{sets[i].id}">Put</a>
                <a href="#">Push</a>
                <a href="#">Del</a>
            </span>
        </div>
        <div class="set_content">
            <?js for (var j = 0; j<sets[i].tabs.length; j++) { ?>
                <div class="tab">
                    <a target="_blank" href="#{sets[i].tabs[j].url}">#{sets[i].tabs[j].url}</a>
                    <span class="actions">
                        <a href="#">Pop</a>
                        <a href="#" id="tab-del-#{sets[i].id}-#{j}" data-setId="#{sets[i].id}" data-tabId="#{j}">Del</a>
                    </span>
                </div>
            <?js } ?>
        </div>
    </div>
    <?js } ?>
</script>

<script>

    var $ = function(id) { return document.getElementById(id); };

    // Set up message event handler:
    window.addEventListener('message', function(event) {

        console.log(template);

        var command = event.data.command,
                template = $(event.data.templateName).innerHTML,
                result = "invalid request";

        // if we don't know the templateName requested, return an error message
        if (!template) {
            result = 'Unknown template: ' + event.data.templateName;
        } else {
            switch(command) {
                case 'render':
                    result = Shotenjin.render(template, event.data.context);
                    break;
            }
        }
        event.source.postMessage({'result': result}, event.origin);
    });

</script>
</body>
</html>
